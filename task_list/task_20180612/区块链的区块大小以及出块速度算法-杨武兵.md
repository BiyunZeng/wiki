# 前言

比特币区块大小限制为1M，出块时间是10分钟一块，它只针对比特币这种单一的使用场景，而且随着比特币的火爆流行，比特币的TPS过低的问题变得越来越突出，社区便有提出区块扩容的意见，通过增加区块大小容量来提升比特币网络的TPS。

初链作为区块链3.0时代的区块链公链，设计之初就应该考虑这些问题，初链一开始就设计为一个通用的区块链平台，能够支持各种使用场景，应该有获得更高的TPS，支持实时或准实时交易场景，设计之初就应该考虑这些问题。

本文将探讨初链的区块大小和出块时间的设计。

# 计算方法
## 目标
区块尺寸大小y1的范围是(0, MaxSize] MaxSize就是最大的区块尺寸，单位设为Byte。

单个区块出块时间假设为BlockTime. 单位设为毫秒。

这个上限我们不能拍脑袋猜出来，应该考虑相关的因素，充分考虑各利益相关方的各种诉求，使得各种因素和诉求能够取得一个合理的平衡。

## 矿工收益和成本
矿工是参与生成区块和存储区块链的参与者，他们需要足够的激励才会持续参与区块链的维护。

假设：每笔交易的平均收益是P，每个交易的尺寸是S个Byte。

矿工的交易费用最大收益 = ⌈(MaxSize/S)⌉ * P. 考虑每个矿工产生的收益要合理，要足以激励足够的节点参与维护区块链。

考虑全节点矿工的磁盘容量限制，如果区块链增长过快，则节点的磁盘无法存储下完整的区块链，则会影响到参与的节点数量，降低去中心化程度。因此区块链容量增长速度要在矿工节点承受范围内。

年增长区块链大小 = MaxSize * ((365*24*3600*1000)/BlockTime)。

假设当前矿工的磁盘剩余可用空间为V，则年增长区块链空间大小应该小于10%。还可以适当考虑一下矿工的磁盘也会逐渐增长。

## 用户的交易成本和效率
用户的交易成本是上面的每笔交易费用，交易费用一般设计为交易额的一个比率。 例如交易额为M，则交易费用为 r * M, r为交易费用比率，从用户的较低期待这个费用尽可能低廉。

在不同的场景下，用户对于交易速度的要求是不一样的，但是用户的期望是尽可能快，不用等太长时间。

交易写入区块链时间是区块生成时间，还有区块确认节点数，希望交易更加可靠，则需要更多的节点确认该区块，等待更多节点确认该区块，则交易更加可靠。区块确认和互联网速度、区块大小有关，区块越大则传区块传播速度越慢。

## 区块链的交易容量
另外对于整个区块链来说，为了支撑更大的应用场景，需要在单位时间内尽可能多的承载交易量。

每秒最大交易量 TPS =  (MaxSize /S) * (1*1000 / BlockTime)。因此从这个维度来看，区块尺寸更大TPS会更大，另外区块生成时间会也会影响到TPS, 区块生成时间应该尽可能小。


# 总结
考虑上述涉及的各种因素，通过调配不同的参数，好到一个平衡点。因为有很多因素都是动态变化的，可以考虑设计一个算法使得区块链能够自适应，根据变化因子的改变而改变，达到一个动态的平衡。
