# 初链黄皮书的个人解读

在解读初链黄皮书之前我们先认识一下初链

# 什么是初链？

初链是一个高性能去中心化公开账本，为了打造一个公开透明的区块链商业世界，着力打造免费、开放、安全高效易用的区块链技术基础行业基础设施，建设区块链经济体运营系统，商业基础设施。

# 从初链架构图来解析初链

我们先来看看初链的架构图，再来看看初链黄皮书着重提到的改进内容

![true架构图.png](https://upload-images.jianshu.io/upload_images/4207935-bd47327e2861c755.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

# 共识算法部分的改进：

我们从架构图中可以看到，初链采用了PBFT+fPOW的混合共识机制，如今单一的共识机制难以兼顾效率和去中心化的本质。一条商业性质的公链需要足够的去中心化以实现安全性，又要高速度保证性能。

一般情况下初链的共识机制默认采用BFT协议，因为此协议能快速处理大量交易。BFT委员会的委员每隔一段固定时间进行切换，新的委员会会由矿工们组成，因此只有挖矿的人才有可能获得成为委员的机会。成为委员后就开始在委员会内选举，选举采用的是PBFT共识算法。此共识在超级账本Fabric的0.6版本中开始使用，一次完整的共识需要经历请求、预准备、准备、提交、回复5个阶段，这5个阶段完成后即选举成功，我们一张图看看PBFT的选举的5个阶段：

![](https://user-images.githubusercontent.com/32947900/42924247-dd0e19ca-8b5b-11e8-9ba5-789bafc2b5eb.jpeg)

### fPOW

初链之前采用的是POW+PBFT共识，通过POW共识选会员，PBFT共识在委员中选举 ，但是POW共识有诸多不利因素，其主要三大点在于：

 - 联合挖矿导致矿池产生，算力都在矿池手中
 - 自私挖矿者攻击，即25%攻击
 - 不稳定交易费：当网络拥堵时交易费越高则越快被打包

因此开始选择采用fPOW共识，此共识为水果链的设计，是一种全新的挖矿设计理念。在挖矿过程中保证所有参与者的公平性。

  在挖矿过程中，PBFT产生大区块，而水果链负责将大区块分成若干水果，这些水果具有保鲜期，每个水果中记录了若干条交易信息，普通挖矿只用验证这些交易信息即可，并不需要投入大量的挖矿设备、电力、带宽，水果链的轻节点设计理念就可以让普通参与者使用普通的计算机，甚至使用手机都能挖矿，解决的普通中POW共识算法存在的25%攻击和大狂吃联合挖矿以及交易费用不稳定这些问题

# 分片优化

我们在架构图中可以看到，初链在底层采用了分片技术优化，初链的分片思想是把区块链的世界状态分割成不同的“片”,每片都由不同的PBFT委员会来处理，把串行处理编程并行处理，从而实现性能的大幅度的提升。

  初链设计了一个基于分片的投机交易处理系统，在混合共识中，DailyBFT实例被索引为一个确定性序列DailyBFT [1 ... R] 。允许同时存在多个DailyBFT实例序列。准确地说，我们通过分片表示t-th DailyDFT序列将分片的数量固定为C，每一个DailyBFT是一个普通的分片，除了C普通分片，我们有一个由csize节点组成的主分片。主分片的工作是最后确定正常分片输出的顺序，以及在分布式事务处理系统中实现协调器。而普通的分片不是直接连接到混合协商一致组件，而是将日志提交给主分片，然后主分片与混合共识进行对话。

# 虚拟机

初链在超级账本的的启发下想将虚拟机替换成容器，那要将Fabric的权限化的性质改成去权限化的话，那面临的第一个挑战就是解决chaincode的问题，虽然可以将一个chaincode或智能合约放在一个容器里，但这对公链来说不是一个可扩展的模型，采用这种模型意味着公链的一个节点可能有几千个容器对应运行在其上的几千个智能合约（因为每个节点都维护一份拷贝），社区已经有人尝试限制运行在一个节点上面的最多容器数。这个限额目前是一个节点100个pod。

如果要扩展容器，大家一般倾向于水平扩展而不是垂直扩展，这是因为后者极大地增加了设计决策的复杂度。由于完全取决于工作负载，并没有一个适合所有人尺寸的集群扩展配置规则，对于True这样的分布式网络则更为复杂。

因此，初链依然选择EVM的设计，但做一些小的改动。


# 智能合约

 智能合约层是共识机制落地的关键一步，智能合约的运行必须依靠虚拟机完成，保证统一只能合约在不同环境下可以运算得到同一结果。初链继承了以太坊的虚拟机的设计思路，并做了更多扩展推出TVM，类似于X86虚拟机，在这种虚拟机中可以运行多种开发语言python、go、JavaScript
 编写的智能合约，不像以太坊只能运行solidity的智能合约。

# 初链黄皮书规划的未来技术实现方向

  - 改进所有节点的时间戳同步，而不需要中心化的NTP服务器。   
  - 喜欢奖励基础设施里的激励技术，这样重度投资基础设施的投资人不会遭遇“被忽视”，“亏本”的问题。
  - 支持副本创建的分片技术，尽量减少被BFT会员会拒绝的交易集。
  - 添加零知识证明以增强隐私。
  - EVM、TVM和Linux容器技术的混合基础设施。
  - 改进虚拟机规范中的二进制数据编码方法，交易签名，收费表等章节。
  

## 个人建议：

  现在来看，未来公链方向其实目前还不明朗，但是在现在看来，没有哪一个公司能全面发展，每个行业总有多个巨头。都说2018是公链的元年，许多公链如雨后春笋的冒出来，公链太多，所以我觉的每一条公链应该找到自己的应用场景，并不是每个行业都适合，深耕一个行业的区块链+ 即可
