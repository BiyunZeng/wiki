# 共识机制
## 什么是共识机制
所谓共识机制，就是在一个时间段内对事物的前后顺序达成共识的一种算法。

## 共识机制有什么作用
* 维系着区块链世界的正常运转。

* 在区块链上，每个人都会有一份记录链上所有交易的账本，链上产生一笔新的交易时，每个人接收到这个信息的时间是不一样的，有些想要干坏事的人就有可能在这时发布一些错误的信息，这时就需要一个人把所有人接收到的信息进行验证，最后公布最正确的信息。

* 共识机制具有一种神奇的力量，它让全网节点达成共识、创造出区块链上的trustless（免信任的）记账机构，保证每笔交易在所有记账节点上的一致性。

## 主流的共识机制
常见的共识机制有：工作量证明机制(Proof of Work - PoW)、权益证明机制(Proof of Stake-PoS)、委任权益证明机制(Delegated Proof of Stake-DPos)、拜占庭共识算法（Practical Byzantine Fault Tolerance- PBFT)

### 工作量证明机制(PoW)
工作量证明，指大家只认你挖矿贡献的有效工作量。电脑性能越好，挖矿时间越长，获得的回报也越多。
PoW机制的代表是：比特币。在挖矿过程中，矿工需要经过大量的计算（哈希碰撞），去试出一个正确的区块哈希值。
假设全网中某节点拥有最大的算力30％，就算它算力最强大，也不是每次都能挖出区块；一开始系统设置就很公平：
* 挖矿是概率事件，相对弱小的节点偶尔也能走运挖到区块；
* 挖矿的概率和计算能力是分不开的，30%算力的矿机有30％的成功概率，也就是说，产生的100个区块里，有30个是这个最强节点挖出来的。

优点：
通过“挖矿”的方式发行新币，把比特币分散给个人，实现了相对公平。
缺点：
* 算力是计算机硬件（CPU、GPU等）提供的，要耗费很大电力和能源。
* 这种机制发展到今天，算力的提供已经不再是单纯的CPU了，而是逐步发展到GPU、FPGA，乃至ASIC矿机。用户也从个人挖矿发展到大的矿池、矿场，算力集中越来越明显。这与去中心化的方向背道而驰，渐行渐远，网络的安全逐渐受到威胁。
* 比特币区块奖励每４年将减半，当挖矿的成本高于挖矿收益时，人们挖矿的积极性降低，会有大量算力减少，比特币网络的安全性进一步堪忧。

### 权益证明机制(PoS)
权益证明机制，通俗一点就是：谁有钱就有话语权。Stake在英文中还有“股份”的意思，因此，我们可以把权益证明机制简单理解为：股份越多，话语权越大。

PoS和上面的PoW有相似之处，均是通过哈希运算竞争记账权／挖到区块；但记账权与账户的币龄（即权益）呈正相关。在PoS机制下，各节点通过币龄证明自己有记账资格。

币龄＝代币数量 x 持有代币的时间，每个代币每天产生1币龄。
PoS机制的代表是以太坊（第四个阶段），那么我们就用以太坊举例。假设你的账户持有100个以太币10天，那么你的币龄＝100 x 10 = 1000。这时，你获得记账权的概率就是100币龄节点的10倍。当你挖出一个以太坊区块，你的币龄就会被清零，重新开始累积。
如果没有按预期挖出区块，那么该节点在本轮被pass掉，换下一个节点。

优点：
* 节能。不用挖矿，不需要大量耗费电力和能源。
* 更去中心化。PoS机制的加密货币对计算机硬件基本上没有过高要求，人人可挖矿（获得利息），不用担心算力集中导致中心化的出现（单用户通过购买获得51%的货币量，成本更高），网络更加安全有保障。
* 避免紧缩。PoW机制的加密货币，因为用户丢失等各种原因，可能导致通货紧缩，但是PoS机制的加密货币按一定的年利率新增货币，可以有效避免紧缩出现，保持基本稳定。
缺点：
* 纯PoS机制的加密货币，只能通过IPO的方式发行，这就导致“少数人”（通常是开发者）获得大量成本极低的加密货币，在利益面前，很难保证他们不会大量抛售。
* PoS机制的加密货币，信用基础不够牢固。

### 委任权益证明机制(DPoS)
DPoS是由全网节点选出代表进行记账，类似于全班同学票选班干部。
每个持币者都可以参与投票，票数最高的前XX名被选为代表（或称“见证人”）。代表数量有限（一般是奇数个），因此他们会互相竞争来获得记账的工作。
如果代表主动降低获得的收入，他们就可以吸引更多人的投票。

优点：
* 能耗更低。DPoS机制将节点数量进一步减少到101个，在保证网络安全的前提下，整个网络的能耗进一步降低，网络运行成本最低。
* 更加去中心化。目前，对于比特币而言，个人挖矿已经不现实了，比特币的算力都集中在几个大的矿池手里，每个矿池都是中心化的，就像DPoS的一个受托人，因此DPoS机制的加密货币更加去中心化。PoS机制的加密货币（比如未来币），要求用户开着客户端，事实上用户并不会天天开着电脑，因此真正的网络节点是由几个股东保持的，去中心化程度也不能与DPoS机制的加密货币相比。
* 更快的确认速度。每个块的时间为10秒，一笔交易（在得到6-10个确认后）大概1分钟，一个完整的101个块的周期大概仅仅需要16分钟。而比特币（PoW机制）产生一个区块需要10分钟，一笔交易完成（6个区块确认后）需要1个小时。点点币（PoS机制）确认一笔交易大概也需要1小时。
缺点：
* 投票的积极性并不高。绝大多数持股人（90％+）从未参与投票。这是因为投票需要时间、精力以及技能，而这恰恰是大多数投资者所缺乏的。
* 对于坏节点的处理存在诸多困难。社区选举不能及时有效的阻止一些破坏节点的出现，给网络造成安全隐患。

### 拜占庭共识算法(PBFT)
也是一种常见的共识证明。它与之前几种都不相同，PBFT以计算为基础，也没有代币奖励。由链上所有人参与投票，少于（N-1）/3个节点反对时就获得公示信息的权利。
优点： 算法的可靠性有严格的数学证明，具备（n-1)/3容错性
缺点：当有1/3或以上记账人停止工作后，系统将无法提供服务。

## 总结
从机制设计上来看. POW 机制更加强调去中心, 更加强调对等.。而DPOS 则是有一个明显的中心, 通过带来部分中心,来得到效率的提升。哪一种机制更好, 有待时间的验证. POW 已经运行快10年, 电力耗费已经非常严重。
    
    







