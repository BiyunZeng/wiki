# 零知识证明


## 零知识证明的概念：

 是由S.Goldwasser、S.Micali及C.Rackoff在20世纪80年代初提出的。它指的是证明者能够在不向验证者提供任何有用的信息的情况下，使验证者相信某个论断是正确的。通俗讲零知识证明就是既能充分证明自己是某种权益的合法拥有者，又不把有关的信息泄露出去——即给外界的“知识”为“零”。


## 零知识证明的原理：

 举一个简单的列子：阿里巴巴被强盗抓住，为了保命，他需要向强盗证明自己拥有打开石门的密码，同时又不能把密码告诉强盗。他想出一个解决办法，先让强盗离开自己一箭之地，距离足够远让强盗无法听到口令，足够近让阿里巴巴无法在强盗的弓箭下逃生。阿里巴巴就在这个距离下向强盗展示了石门的打开和关闭。这个整个过程就是零知识证明，证明者能够在不向验证者提供任何有用信息（石门的口令）的情况下，使验证者相信某个论断（阿里巴巴知道打开石门的方法）是正确的。


## 零知识证明在区块链的运用

 主打匿名性的区块链加密货币ZCash里用到了零知识证明来保证交易双方和交易金额的匿名性，直接讲解ZCash的交易过程可能会比较抽象。为了有助于理解，我们不妨先分析比特币，作为铺垫。

 我们先来打个比方说明比特币的转账原理

 演示场景：Alice转1个比特币给Bob

 转账前，Alice要事先准备1个比特币。为了方便理解，我们把Alice准备转出的这1个比特币看成一张面额为1个比特币的“支票”

 ![](http://img.mp.itc.cn/upload/20161217/e5cfe3f5c2c64c4e92f8a2825a4439c6.jpg)

 
 支票的面额和转账权都已经明确，Alice就可以给Bob转账了。转账的原理很简单，就是给Bob新建一张一样的“支票”，证明Bob拥有了1个比特币。同时撕掉Alice手中的“支票”，通过这“破旧”并“立新”的方式，实现资产所有权的转移。

 ![](http://img.mp.itc.cn/upload/20161217/4b652220b9424cb7afba1ca7a50c565d.jpg)

 以上逻辑其实不难理解，因为这和日常生活中的银行转账是一个道理。通过银行转账，我们在交易时不必对实物货币进行转移，而是以银行记账的方式，实现“资产所有权”的转移。比特币交易的过程实质上就是一个“资产所有权”的转移过程，转入比特币的那一方“新建”一份资产所有权，而转出方需要“销毁”原先的资产所有权，被销毁的那张“支票”永远不会再出现。

 然后我们再来看看ZCash的转账原理：

 与比特币一样，ZCash的交易过程也是 “资产所有权”的转移。继续沿用前文“支票”的比方ZCash代币为ZEC。

 演示场景：Alice转1个ZEC给Bob。

 转账前，Alice创建一张面额为1个ZEC的“支票”
 
 ![](http://img.mp.itc.cn/upload/20161217/b183ce422c6349a7a866da4c35335772.jpg)

 对比比特币转账的那张Alic“支票”我们可以发现：这张“支票”上多了一串随机数，用符号 r 表示。这串随机数的作用好比“支票代号”，用来唯一识别该支票。Alice的“支票代号”为r1。

 第一步:比特币一样，要先为Bob新建一张“支票”。Bob的支票代号（r2）与Alice的支票代号（r1）不相同，如图

 ![](http://img.mp.itc.cn/upload/20161217/9ae84dcffdc84ce6b3f7b95e5910bcde_th.jpg)

 第二步：新的“资产所有权”生成的同时，必须要想办法销毁原来的“资产所有权”。即必须想办法让Alice手中的“支票”失效。

 与比特币简单粗暴的“直接撕毁”不同，ZCash采用“备注作废”的手段，达到同样的效果。怎么理解呢？

 就是在不对原先“支票”作任何处理的前提下，新建一个作废文件列表，录入需要作废的“发票代号”。

 ![](http://img.mp.itc.cn/upload/20161217/d38a4be6895f455892b01980e217d2f5_th.jpg)

 从上图可以看出，原先的Alice持有的支票仍旧存在，并没有消失，只是这张支票已经被记入“作废列表”。在确定资产所有权时要同时读取两个列表的信息，能确定Bob拥有资产所有权的判断方法是：作废列表中不存在Bob所持“支票”的代号。

 ZCash为什么要这样设计呢？其实这样设计的目的是为了在交易过程中运用 “零知识证明”。

 那么零知识证明怎么运用到ZCash交易过程中呢？我们再回顾比特币和ZCash的例子。

 Alice要向Bob转一个单位的数字货币（BTC/ZEC），即Alice要向Bob转移一个单位的资产所有权。他们分别的做法：

 （一）比特币中的做法：Alice拥有一张1BTC的支票，要转账给Bob时，先给Bob新建一张1BTC的支票，同时当着Bob的面将自己原先的支票撕毁。

 （二）ZCash中的做法：Alice拥有一张1ZEC的支票，要转账给Bob时，先给Bob新建一张1ZEC的支票，然后在一张约定有效的作废列表中，记录下Alice的发票的代号，证明Alice的支票已经失效。

  ZCash的方法属于零知识证明。整个交易过程中，Bob并没有见过Alice的支票，但是还是实现了资产所有权的转移。在ZCash的整个交易系统中，Alice和Bob的交易还有其他见证者，即负责记录交易信息的矿工。同样道理，矿工也不必看到Alice的支票，只要能确定代号为r1的支票已经作废了就行。

  判断的逻辑相当简单：矿工拿到Alice给的支票代号r1，去作废列表中检索，假如作废列表中已经存在r1，则证明r1所对应的的支票早已失效；若作废列表中并不存在r1，则证明r1对应的支票仍旧有效，此时矿工把r1录入作废列表中，把新生成的支票录入支票列表中。所以记账的过程就是对原有支票登记失效，并存入现有支票的过程。

  在这个过程中，我们不难发现，每笔交易矿工能接收到的东西只有一个发票代号，和一张新的发票，而且这两样东西都是被加密的。所以矿工并不知道转账双方是谁，也不知道转账金额是多少。


## 零知识证明的优点：

 - 在使用零知识证明的时候，不降低安全性。 

 - 零知识证明工作高效，计算过程量小，双方交换信息少。
