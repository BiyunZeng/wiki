# 提升公链的tps的方法之一--闪电网络 0615 --ted 
## 公链区块与侧链的区别

公链的区块可以理解为高速公路,比如开着一辆车在高速公路上飞驰,上高速时候我们要先过服务点登记发一张卡（发起交易向节点广播,进入内存池）,下高速时给你开一张发票(理解为交易被确认,时间戳证明以及交易hash)。
而另外这一种交通方式则不同,比如说地铁,不同于现实中的有几个区别,这里我们是冲卡的,每次使用并不到中央服务器结算(不到区块链结算),而是是需要到你连接到的地铁节点结算(你连接的节点以及你的签名),这时就大大降低了中央服务器的流量,从而可以得到极快的确认,只有最后一笔才到中央服务器结算,运营

闪电网络就是通过一种二层协议的方式来解决支付问题,只有最后一笔才到区块链结算。

## 为什么需要闪电网络

举个例子：2017年双十一支付宝的峰值是25.6万笔
,目前每天平均处理上亿笔交易(假设支付宝的平均每秒处理四千笔交易)。
这里我们假设每笔的交易大小为200个字节,如果区块链网络想要达到支付宝的平均水平,每十二秒需要处理9MB字节数据(这里假设是主链币转账且gas都一样),一天则是接近七百亿个字节的区块重量,每年的数据将超过**2万亿字节**的区块数据。

区块过大会导致网络中心化,只有能够承担昂贵的运营成本的大节点(大矿池)才能验证交易,而普通节点则会被挤出转而去运行轻节点,那么只有少量的大节点（矿池）去维护账本的一致性,这时就难以保证网络的安全,只要网络价值越高,大节点就有更大的动力去作恶,一味的去扩容可能会导致意想不到的后果,所以二层协议成为了一个可以选择的方案。

## 闪电网络的核心的概念

**RSMC:可撤销的顺序成熟度合同**
**HTLC:哈希时间锁**

Recoverable Sequence Maturity Contract，中文可以翻译为“可撤销的顺序成熟度合同”。
我们先通过公网,用户与节点运营方通过智能合约生成多重签名地址,双方都存入等值的币,同时生成一笔双方签署的从签名地址转回自己地址的交易(但是不广播)。每次交易,就重新对这个双方签署的交易共同进行确认同时将旧的那一笔作废。当一方需要体现时,将最后一笔交易(带有双方签名的交易)广播到区块链上,这时会有一个机制,在一定时间内,提出方如果拿出一笔已经作废的交易(非最新交易),而质疑方则拿出了证据（完整的账本）证明提出方拿出的交易是已经作废的交易,则将资金全被给质疑方,这里就确保了没人会拿一个旧的交易来提现。
另外，即使双方都确认了某次提现，首先提出提现一方的资金到账时间要晚于对方，这就鼓励大家尽量都在链外完成交易。

HTLC
Hashed Timelock Contract  中文的意思是"哈希时间锁合约"
发起交易时,双方约定转账方限冻结一笔钱,并提供了一个哈希值,如果在一定时间内有人能提出一个密文,并且哈希后的值与已知的哈希匹配,则这笔钱就转给接收方（实际上是重新签署一笔交易,修改余额再加上双方的签名）。

RSMC保障了两个人之间的交易可以在链下完成,HTLC保障了任意两个人的转账都可以通过一条或者多条通道来完成,整合这两种机制,就可以实现任意两个人之间的交易可以在链下完成。

节点通讯则是通过p2p技术,交换路由表的形式来互相发现,而软件内可以内置几个长期节点（类似下载中的种子节点）。


闪电网络的优点

* 可以即时支付
* 任何人任何组织都可以设立节点
* 对节点的性能需求并不高，只要能储存账本以及闪电节点就行
* 通过路由系统自动寻径(寻找花费最少的路径),网络中的节点充分竞争，使得交易成本降低
* 匿名性(每一个节点只记录该通道内的交易)
* 内置一个**hsmd**进程保证私钥的安全



缺点

* 每开启一个通道就需要手动创建一个昂贵的链上交易，关闭也需要创建一个昂贵的链上交易
* 构建一个庞大的二层网络,不仅仅技术上是难题,让用户以及商家接受也是一个难题。
* 其次每个节点都需要抵押一定的币,才能开启节点,长时间暴露在公网中,可能会存在私钥泄露的问题
* 由于每一笔交易信息都储存本地,可能会存在交易丢失的风险。
* 可能会出现大型的渠道运营商,可能会有一定的中心化(但是也有一定的好处,有一个长期稳定的种子节点)
* 非法矿工可以使用51攻击从闪电网络节点窃取资金





