# 链下扩容方案


##  前言
&emsp;&emsp;现阶段各公链的性能就如同90年代的拨号互联网一样，根本无法支撑各现实中的应用场景，导致其吞吐量低的关键原因在于链上的每个操作都要所有节点进行处理才能达成共识，这构建了一个“超慢的分布式系统”，虽然新的共识算法不断的提出，但这无法从根本上解决问题。


## 现阶段扩容方案
### 一、layer1解决方案
&emsp;&emsp;涉及区块链基础级协议的，通常被也称为第一层（layer 1）扩展解决方案
&emsp;&emsp;1、扩大单个区块容量（区块gas limit上限），这种方式对系统的性能会有少量的提升，但会加大节点处理单个区块的工作量，也会延长区块在网络的传输时间，导致更多的孤块或者孤儿链，如果频繁的导致孤块则可以认为该系统是不可靠的；

&emsp;&emsp;2、采用新的共识算法,pos,dpos,pbft等；
* pos共识算法虽然在一定程度上缩短了共识时间，也解决了pow的资源浪费问题，但本质上pos还是需要挖矿和全部节点确认来成共识，只不过使用币来挖矿，更严重的是由于pos采用币生币的方式，极端情况下可能会带来中心化的结果；
* dpos 采有代理人的方式去记帐，不需要系统中所有节点参与，理论上能大幅提高系统的tps,但这样做的方式会极大的降低系统的去中心化程度，降低系统的安全性；
* pbft 算法通过投票来达成共识，重一致性，可以很好的解决分叉和提升效率，但这类算法需要节点间两两进行通信，只能用于节点数较少的环境中；

&emsp;&emsp;3、sharding:在现有公链网络中每一笔交易需要所有的节点处理才能达成共识这极大的制约了公链的吞吐能力，sharding 的思想是 如果每个节点不必处理每一笔交易会怎样？如果我们可以构建一个每个节点不必处理每个操作的区块链，会怎样？如果网络分为两个部分代替原有网络，每一个部分都可以独立运行，会怎样？
&emsp;&emsp;A 部分可以处理一批交易，而同时 B 部分可以处理另一批。这实际上会使区块链的交易通量翻倍。因为我们的限制现在能够被两个节点同时处理。如果我们可以将区块链分为许多不同的部分，那么我们可以将区块链的通量提高很多倍。这是以太坊中sharding的思维模式，由于该模块并未上线，我们无法对其实际性能做出评价。

### 二、layer2解决方案
&emsp;&emsp;不需要更改基本级别的协议，只是作为智能合约，用于与链下软件进行交互，通常称为第二层(off-chain)扩展解决方案
&emsp;&emsp;1、状态通道（state channels），是一种在链下执行交易和状态更新的技术，在通道中的事务仍然保持了很高的安全性和权威性，当出现争议时能在主链上得到解决；
&emsp;&emsp;状态通道的适用于短期内双方需要进行大量的交易的情况，当双方开始交易之前先在主链上部署合约并开启通道，交易时双方只需把各自的交易签名后发给对方，双方确认后并在交易后面签名，当所有交易结束后再把最后状态写到主链上，不需要将所有交易写到主链上；当出现争议时，争议方只需要在等待时间内将争议提交到主链进行判决。
&emsp;&emsp;目前这方面著名的项目有闪电网络和雷电网络；但状态通道有很大局限性，如：可靠性依赖，交易的双方必须同时在线；

&emsp;&emsp;2、celerNetwork,针对于目前扩容方案的不足，celerNetwork的出现让我们看到了希望，celerNetwork是一个运行在现有及未来区块链之上的网络化系统，旨在为底层区块链系统带来互联网级别的性能；其采用了类似Internet的分层架构，分为通道层（cChannel）、路由层（cRoute）、系统层（cOS）,各层相互独立，通道层主要负责与底层区块链交互及维护离链数据，是整个系统的核心，实现了类似状态通道和侧链功能并对其不足进行了有效改进；路由层则类似于TCP/IP中的网络层，负责最佳路由选择，而且celer提出了分布式平衡路由算法，使其具有去中心化、安全性、强稳定性等优点，其吞吐量比目前最先进的算法提高了15倍；系统层则提供了通用的api及应用程序开发框架，是离DApp开发者最近的一层，供开发者在其之上开发应用；

&emsp;&emsp;最近很忙，今天先写这么多，后续再补充；

参考：
celerNetwork白皮书  https://www.celer.network/doc/CelerNetwork-Whitepaper.pdf
sharding https://medium.com/@icebearhww/ethereum-sharding-and-finality-65248951f649
闪电网络 https://lightning.network/
状态通道 https://www.jeffcoleman.ca/state-channels/
