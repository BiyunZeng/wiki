#  闪电网络

## 1.为什么需要闪电网络
举个例子：2017年双十一支付宝的峰值是25.6万笔
,目前每天平均处理上亿笔交易(假设支付宝的平均每秒处理四千笔交易)。
目前以太坊网络每秒能够处理大概六笔交易左右,这里我们假设每笔的交易大小为200个字节,如果以太坊网络想要达到支付宝的平均水平,每十二秒需要处理9MB字节数据(这里假设是以太坊币转账且gas都一样),一天则是接近七百亿个字节的区块重量(**大约6.5个G左右**),每年的数据将超过**2万亿字节**的区块数据(**大约2T的样子**)。

显然,如果想获得支付宝的TPS显然是不可行的,在这个世界上没有家用电脑可以有那样的带宽以及储存。如果未来一切的电子交易都在链上执行,那么这会使得整个生态的崩溃,到时候只有可以支付的昂贵的带宽以及储存能力的大组织可以运行全节点,这种中心化会再次打败网络分散化,使得区块链的安全性进一步下跌。

较大的区块意味着验证门槛的提高(**抬高维护验证节点的成本**),不仅仅使得验证节点数量的降低,更意味着算力的进一步中心化(会使得小矿池更加没容身之地),极端的情况下大矿池可能会绑架整个网络(肆意抬高交易费用),这对网络生态也是一种伤害。

## 2.什么是闪电网络
什么是闪电网络,闪电网络是一种p2p网络,所谓离链交易(OFF-BLOCKCHAIN),与闪电节点通过智能合约生成了一个多重签名地址(通道),用户与节点运营方同时存入等值的比特币,同时生成一笔从签名地址转回用户钱包的交易(不广播)。
例子A转账给e
1.首先通过闪电网络的路由系统找到可以连接他们的两个或者多个通道的路径(并且识别途中的节点是否有足够的余额)
2.然后A通过某种路径把密文发送给e
3.这时A与B签署协议,然后B和C签署协议以此类推
4.这时D从E获取到合法的密文,然后往回发送直到A节点,如果验证合法将依次转账。
![GITHUB](https://github.com/Theodoree/Theodoree.github.io/blob/master/思维导图/闪电网络.png?raw=true)


## 3.可行性方案
扩容并不能解决支付问题,如果全世界都使用该网络,那么扩容几百倍几千倍只会凭空使得去中心化的网络变得中心化,当一条链的TPS达到几十万甚至上百万时,家用级无法承受那么昂贵的存储费用以及网络费用,那么二层协议,侧链可能就会成为一种解决方案。

核心的概念主要有两个：RSMC（Recoverable Sequence Maturity Contract）和 HTLC（Hashed Timelock Contract）。前者解决了链下交易的确认问题，后者解决了支付通道的问题。

RSMC
Recoverable Sequence Maturity Contract，中文可以翻译为“可撤销的顺序成熟度合同”。
我们先通过公网,用户与节点运营方通过智能合约生成多重签名地址,双方都存入等值的币,同时生成一笔双方签署的从签名地址转回自己地址的交易(但是不广播)。每次交易,就重新对这个双方签署的交易共同进行确认同时将旧的那一笔作废。当一方需要体现时,将最后一笔交易(带有双方签名的交易)广播到区块链上,这时会有一个机制,在一定时间内,如果另外一方提出他所谓的最后一笔交易是已经作废了的交易(非最新交易),则将资金全被给质疑方,这里就确保了没人会拿一个旧的交易来提现。
另外，即使双方都确认了某次提现，首先提出提现一方的资金到账时间要晚于对方，这就鼓励大家尽量都在链外完成交易。

HTLC
Hashed Timelock Contract  中文的意思是"哈希时间锁合约"
发起交易时,双方约定转账方限冻结一笔钱,并提供了一个哈希值,如果在一定时间内有人能提出一个密文,并且哈希后的值与已知的哈希匹配,则这笔钱就转给接收方（实际上是重新签署一笔交易,修改余额再加上双方的签名）。

RSMC保障了两个人之间的交易可以在链下完成,HTLC保障了任意两个人的转账都可以通过一条或者多条通道来完成,整合这两种机制,就可以实现任意两个人之间的交易可以在链下完成。

而节点之间获取路径是通过交换路由表的方式来完成的,类似比特币的P2P节点发现。
至于寻径则是通过特点的算法实现的

**闪电网络的优点**
* 可以即时支付
* 对节点的性能需求并不高
* 通过路由系统自动寻径(寻找花费最少的路径),网络中的节点充分竞争使得交易费用可以低
* 匿名性(每一个节点只记录该通道内的交易,)


**比特币的闪电网络的缺点**:

* 如果换一种代币就需要重新开启通道,节点和用户的成本都相当的高。
* 没有足够的商家支持闪电网络,使得作为节点的收益并不高,由于没有足够的商家支持,用户使用闪电网络的需求并不高
* 闪电网络是小额支付,开启通道是需要使用公网的,使用公网意味着要发起一次交易,如果只转入几百块,一次交易就需要几十块,可能就得不偿失了。
* 关闭通道时,也需要发起交易,将通道中的币分配给通道以及用户,这又需要发起一次交易,又需要发起一次交易
* 其次每个节点都需要抵押一定的比特币,才能开启节点,长时间暴露在公网中,可能会存在私钥泄露的问题
*  现阶段闪电网络并不完善处于一个初始版本



## 4.引用文献

* 比特币闪电网络白皮书 版本号为:0.5.9.1
* [比特币闪电网络分布图](https://lnmainnet.gaben.win)
* [资料](http://idgui.com/RouPay.com/)
