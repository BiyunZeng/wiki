# 初链：高性能去中心化公开账本
###### 作者：lucaskuang
## 绪论
2017-2018年，互联网界最火热的话题之一就是区块链。其去中心化、分布式以及防篡改一系列特性使得人们对于这个可能对互联网发展产生重大影响的技术关注颇多。从比特币的区块链最初版本，到以太坊为主流的进阶版本，再到超级账本项目的版本，区块链技术一直在飞速的发展，并且不断落地到各个领域。本文我将简单介绍区块链中的相关概念以及相关技术理念。
## 什么是区块链
所谓区块链，字面上的理解就是由很多的“区块”组成的链式结构，区块我们成为“block”，区块链的全名为“blockchain”。很多人在聊到区块链的时候，往往容易认为区块链就是比特币，比特币就是区块链。实则不然，区块链是比特币的底层技术。在具体说到区块链的概念之前，我们先了解几个问题。
### 拜占庭将军问题
在区块链的学习当中，要理解分布式系统问题，大部分的学者都会举出拜占庭将军的问题。故事大致是这样的：古代希腊有一个国家叫拜占庭，国力雄厚，拜占庭中的一位将军喜欢征战，想把别的国家的资源抢夺到自己手中。在攻打敌方国家的时候，将军派出了10支部队同时去攻打。当然敌对国也不是吃素的，在拜占庭将军排除的10支部队中，需要有6支或者以上的部队同时发起进攻，才能取得胜利。那么这个问题就属于一个典型的分布式的问题，在这个分布式系统中有10个节点，我们希望这10个节点同步，一起在同一时间执行同一个操作。也就是说拜占庭将军希望这10支部队在同一时间攻打敌方国家。但是在将军发出一起攻打的命令时，通讯兵有可能会被敌军俘获，或者通讯兵表达能力欠缺，有可能把将军的命令表达错误。这些问题可能导致通讯兵传递出去的数据时错误的，那么这10支部队肯定保持不了同步，攻打的结果极有可能是失败。所以这就是拜占庭将军的问题所在。
### 分布式
如果大家是IT工作者的话，对于“分布式”这个名词肯定很熟悉。我就以我们最为熟悉的git代码版本管理工具为例，它就是一个典型的分布式管理工具。如果我们的开发团体中有10个人在进行项目开发，每个人在开发自己的代码前，都需要和master分支进行merge。10个人的代码都进行了同步，如果有成员或者master分支出现了代码丢失的情况，那么他可以从别的组员中进行恢复。也就是说，在分布式系统中，每一个节点拥有的数据都是相同的，如果某个节点出现了问题，那么其他节点可以当做新的参考进行数据恢复。
### 去中心化
先来说说什么是中心化，在我们日常的交易中，都有着中心化的概念，比如用户在淘宝上购买商品，用户首先需要对自己选购的商品使用支付宝付款，但是付款并不会直接打到卖家的账户上，而是暂由阿里巴巴集团支付宝代收，在买家确认收货后，付款才会最终到达卖家的账户上。那么这个交易过程中明显就有着阿里巴巴支付宝这个中心的存在。也就是说这个交易有着第三方的平台参与。这就是所谓的中心化概念。中心化的机制必然会产生一些交易问题，比如说买家和卖家在交易过程中，第三方平台服务器突然崩溃，导致数据丢失等等不可控的问题，必将对交易造成恶劣影响。而去中心化就是使得在交易过程中剔除第三方，买家和卖家直接交易。去中心化的其实就是网络中的节点与节点之间相互信任，去除了常见分布式系统中的中心系统的概念。
### 分布式系统中，听谁的？
在分布式系统中存在着一些问题，相信做过Java的同学很有体会，往往在分布式系统的实现中，有一个很非常重要的问题，那就是谁说了算？听谁的？如果才能保持数据一致？典型的例子就是我们在实zookeeper集群时，在该分布式系统当中选举出一个领导，在该网络内所有的分支都听这个领导的。如果在该网络中这个领导挂掉了，zookeeper会在剩下的分支当中，再选举一个分支作为新的领导，但是zookeeper在实际的生产环境中，也存在一些问题，就是如果第一个领导挂掉的时候，并没有彻底死亡，有一部分还存活着，但是新的领导分支已经选定，那么此时存在两个领导。那么两个master手下的分支就会出现我们所说的“脑裂”问题，它们不知道到底该听第一个领导的还是第二个领导的。其实zookeeper是属于一种中心化的分布式实现。
### 区块链概念
在了解了上述的几个问题后，区块链的概念就很好理解了，区块链是一个去中心化的分布式账本（数据库）。区块链系统实际上就是一个维护公共数据账本的系统，一切的技术单元的设计都是为了更好地维护好这个公共账本。
## 区块链的主要技术架构
通过区块链的概念我们知道，区块链在本质上来说就是一种记账方法，当然它并不是通过人来记账的，而是通过一种软件，我暂且称它为区块链客户端。他们运行于不同的设备上，彼此之间独立工作。通常我们把运行中的客户端成为“节点”。所有的节点都在一个互通的网络中，在网络中，一旦有什么交易发生，消息就会马上广播传遍给每个节点。在区块链软件的结构中，这中互相通信的功能成为“网络路由”。

在这个网络中，每个节点都维持着自己的账本，账本记录着网络中每一笔账务。具体是什么样的账务呢？这得看具体是什么样的功能网络。区块链技术属于一种技术方法，可以用来实现不同的业务功能，例如小到日常记账，大到各种复杂的商业合约等等。那么网络中的记账需要保持一致，所用的方法就是大家遵守一个规则，通过规则选出记账的节点。那么这种规则就成为“共识算法”。

在有些系统中，会考虑到通过规则选出的节点这个过程中所付出的劳动，毕竟这个节点需要通过不断得通过“工作证明”来取得记账权，还是挺辛苦的。于是会设计一种激励机制，负责打包数据以及广播的那个节点可以获得系统的奖励。那么大家都会很积极地去争取那种奖励。有些区块链系统会设计一种带竞争的机制，让各个节点去抢夺，谁能抢到这个机会就能获得数据打包的权利并且获得这笔奖励，这种情况下我们会形象地将这个竞争的过程称为“挖矿”。

那么，话又说回来了，我们将一个个运行客户端成为节点，那到底怎么标记不同的使用者呢？也是通过用户注册吗?其实不然，在区块链系统中，是通过一种密码算法来实现的，具体来说是通过一种叫公开秘钥算法的机制来实现的。我们知道对于一种密码算法来说，无论算法过程是什么样的，都会有一个秘钥，而公开秘钥算法拥有一对秘钥，是彼此配合使用的，可以相互用来加密和解密的。其中一种叫公钥，另一种叫私钥，公钥可以公开给别人，私钥要自己保存好。在区块链中，公钥是用来用户识别身份的。

那么两种秘钥是如何配合工作的？我来简单说明一下：用公钥加密的数据必须使用对应的私钥来解密，而使用私钥加密的（通常称为“签名”）的数据必须用对应的攻牙来解密。举个例子，张三要发给李四一张支票，那么怎么传送过去呢？直接发送过去，那么支票中的数据必然会被全网的其他的节点都知晓，这个处于安全性考虑肯定是不允许的。于是张三在支票上用李四的公钥加了密，然后再签上自己的名字（使用自己的私钥签名），这样的话，即使其他人拿到这张支票也没用，因为只有李四拥有自己的私钥来能解开这张支票来使用。这种功能设计在区块链系统中称为“脚本系统”。

总结：现在我们知道了，区块链的技术理念其实就是大家共同来参与记账，通过一种规则（共识算法）不断地选出账务打包者，其他节点接受验证，并且每个用户都有一对秘钥表示自己，通过脚本系统的功能实现在公共网络中定向发送有价值的数据。
## 区块链的工作流程
区块链的应用有很多种，第一个应用区块链技术的软件就是比特币，到现在为止，出现了很多机遇区块链技术的衍生系统，比如闪电网络、公正通、以太坊、超级账本项目等。但是无论设么类型的应用，它们的工作方式或者说工作流程都是相似的，本质上他们都是同一种技术结构的产物。我们接下来说说区块链的工作流程。

我们先来看一个转账交易的流程。转账交易本质上就是发送一笔数据，这个数据可以表示为资产，也可以表示为订单或者其他形式的数据，我们看一下下面的图示：
![](https://img-blog.csdn.net/20180417145354587)
在图中，我们可以看到，整个数据的发送过程还是比较简单的，数据发送出去后，会被打包进区块，然后广播出去给所有节点确认，确认没有问题后就写入给的本地区块链账本中，当网络中的大多数节点都确认写入后，确认没问题后就写入到各自的本地区块账本中，当网络中大部分的节点都确认写入后，这个转账交易就算完成了。

这个工作流程是具有代表性的，其他各种系统都是在这个基础上进行衍生和扩展的，如有些会增加身份认证功能，以确保只有符合身份的验证的用户才能发送数据，有些扩展交易数据的表达能力，不但能用表示一般的交易转账，还能表示更复杂的商业逻辑，各种应用很多，但是万变不离其中。
## 初链：TrueChain
随着区块链技术优势不断体现，在各个领域都相继有成功的区块链应用落地实现。区块链应用解决方案，在市场上需求也越来越大。打造承载未来商用去中心化应用的公链，是时代的需求，也是初链的梦想。基于混合共识机制设计的初链，旨在为社会提供高速点对点通信、价值传输以及智能合约基础设施。在此之前，部分私有链与联盟链已成功落地应用，让人们对公链开发者们产生了更大期望，初链在保持去中心化本质的同时，提出了POW与PBFT相结和的混合共识设想，旨在区块链上的发展道路上贡献出更多的力量。

